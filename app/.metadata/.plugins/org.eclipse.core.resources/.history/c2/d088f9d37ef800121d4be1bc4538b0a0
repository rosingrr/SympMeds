package com.example.sympmeds;

import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;

import jxl.Cell;
import jxl.Sheet;
import jxl.Workbook;
import jxl.read.biff.BiffException;
import android.app.Activity;
import android.content.Intent;
import android.content.res.AssetManager;
import android.os.Bundle;
//import android.util.Log;
import android.view.Menu;
import android.view.View;
import android.widget.ArrayAdapter;
import android.widget.Spinner;

public class SymptomList extends Activity {
	public final static String DRUG_LIST = "com.example.sympmeds.LIST";

	/**onCreate() is called when the SymptomList activity is started, which is when the
	 * Start button from the MainActivity is pushed.
	 */
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		//this is default code
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_symptom_list);
		
		//open excel file and get symptom sheet
		AssetManager assetManager = getResources().getAssets();
		InputStream inputStream = null;
		try{
			inputStream = assetManager.open("Database.xls");
		} catch(IOException e) {
			//Log.e("SYMPMEDS", "error 1");
			e.printStackTrace();
		}
		//Log.v("SYMPMEDS", inputStream.toString());
		Workbook wb = null;
		try{
			try {
				wb = Workbook.getWorkbook(inputStream);
				//Log.v("SYMPMEDS", "wb = workbook worked");

			} catch (IOException e) {
				//Log.e("SYMPMEDS", "error 2");
				e.printStackTrace();
			}
		} catch(BiffException e) {
			//Log.e("SYMPMEDS", "error 3");
			e.printStackTrace();
		}
		try {
			inputStream.close();
			//Log.v("SYMPMEDS", "inputStream.close() worked");
		} catch (IOException e) {
			//Log.e("SYMPMEDS", "error 4");
			//e.printStackTrace();
		}
		Sheet sheet = wb.getSheet(0);
		//Log.v("SYMPMEDS", sheet.getName());
		
        //enter array into spinner
		ArrayList<String> arrayList = new ArrayList<String>();
		for(int i = 1; i < sheet.getRows(); i++){
			Cell cell = sheet.getCell(0, i);
			String text = cell.getContents();
			arrayList.add(text);
		}
		//Log.v("SYMPMEDS", "array is set");
		String[] array = arrayList.toArray(new String[arrayList.size()]);
		Spinner spinner = (Spinner) findViewById(R.id.symptom_spinner);
		ArrayAdapter<CharSequence> adapter = new ArrayAdapter<CharSequence>(this, android.R.layout.simple_spinner_item, array);
		adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
		spinner.setAdapter(adapter);
		//Log.v("SYMPMEDS", "spinner works");
	}

    /**
     * This was generated by default by Eclipse
     */
	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.symptom_list, menu);
		return true;
	}

    /** Called when the user clicks the Search button.
     * It calls up the DrugList activity with all the information that is respect to
     * what is selected from the spinner in this activity.
     */
    public void search (View view) {
    	// Do something in response to button}
		Intent intent = new Intent(this, DrugList.class);
		Spinner spinner = (Spinner) findViewById(R.id.symptom_spinner);
		String text = spinner.getSelectedItem().toString();
		intent.putExtra(DRUG_LIST, text);
		//Log.v("SYMPMEDS", "drugList activity starting");
		startActivity(intent);
    }
}